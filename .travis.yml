language: python
python:
    - "3.6"
    - "3.7"

dist: xenial
services:
    - docker

branches:
    only:
        - master
        - develop
        - /^release.*$/
        - /^feature.*$/

env:
    - TEST_DIR="testcase/unittest"
    - TEST_DIR="testcase/integration"

before_install:
    # Basic dependencies
    - sudo apt install -y make build-essential libssl-dev zlib1g-dev libbz2-dev libreadline-dev libsqlite3-dev wget curl llvm libncurses5-dev libncursesw5-dev xz-utils tk-dev libffi-dev liblzma-dev automake libtool lsof

    # Rabbitmq service
    - docker pull rabbitmq:3.7
    - sudo docker run -d -p 5672:5672 -h localhost --name rabbit rabbitmq:3.7

    # icon_rc -> Go
    - wget https://dl.google.com/go/go1.12.7.linux-amd64.tar.gz
    - sudo tar -xvf *.gz
    - sudo mv go /usr/local
    - go version
    - export GOROOT=/usr/local/go
    - export PATH=$GOROOT/bin:$PATH

    # icon_rewardcalculator
    - git clone https://github.com/icon-project/rewardcalculator.git
    - cd rewardcalculator
    - make linux
    - sudo install -m 755 ./linux/icon_rc /usr/local/bin
    - sudo install -m 755 ./linux/rctool /usr/local/bin
    - cd -

install:
    - make develop

script:
    - which icon_rc
    - pytest $TEST_DIR -vv

notifications:
    email:
    # - t_core@icon.foundation

